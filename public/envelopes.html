<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
	<title>Personal Budget</title>
	<!--Start Bootstrap CDN (And jQuery I think)-->
	<!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<!--End Bootstrap CDN-->
	<!--postData()-->
	<script>
	  /**
		* postData()
		* async function that posts form data to the server database
		* 
		* Gets the data from #name and #amount from the form, then sets puts that in an object.
		* A post fetch() request is then made to /evelopes. 
		*/
		const postData = async () => {
			const name = document.getElementById("name");
			const amount = document.getElementById("amount");
			const data = {name: name, amount: amount};
			try {
				const response = await fetch("http://localhost:3000/envelopes", {
					method: "POST",
					body: JSON.stringify(data),
					headers: {
						"Content-Type": "application/json"
					}
				});
				if(response.ok) {
					const jsonResponse = await response.json();
				}
			} catch(e) {
			  //get request to err page
				console.log(e);
			}
		}
	</script>
	<!--removeMarkers()-->
	<script>
	  /**
		* removeMarkers()
		* removes those weird :marker <li> things
		*
		* Gets all the <li> elements in #envelopes-list, then iterates through the 
		* HTMLCollection to see if it has a falsy innerHTML value. If it does, it removes it from the DOM
		*/
	  const removeMarkers = () => {
		  const ulList = document.getElementById("envelopes-list");
		  const ulListChildren = ulList.children;
		  for(let i = 0; i < ulListChildren.length; i++) {
		    let item = ulListChildren.item(i);
		    if(!item.innerHTML) {
			    item.remove();
		    }
		  }
	  };
	</script>
	<style>
    li {
		  text-decoration: none;
	}
	</style>
</head>
<body>
  <div id="wrapper" class="container-fluid">
	  <header class="row">
			<h1>Envelopes</h1>
			<hr />
		</header>
		<main class="row">
		  <div class="row">
			<div class="col-sm-3"></div>
              <ul style="text-align: center;text-decoration:none;" id="envelopes-list" class="list-group col-sm-6"></ul>
			</div>
			<div class="col-sm-3"></div>
            <form class="col-sm-6" action="/envelopes" method="post">
              Bill: <br/><input type="text" name="name" /><br/>
		      Amount: <br/><input type="text" name="amount" /><br/>
		    <input type="submit" class="btn btn-success" onclick="postData()"value="Submit" />
	    </form>
		</main>
  </div>
	<script>
	  /**
		* 
		*/
		const getData = async () => {
		  try {
				const response = await fetch("http://localhost:3000/envelopes/list");
				if(response.ok) {
					const jsonResponse = await response.json();
					console.log(jsonResponse);
					return jsonResponse;
				}
			} catch(e) {
				console.log(e);
			}
		}
		const list = document.getElementById("envelopes-list");
		const items = getData().then(jsonResponse => {list.innerHTML = jsonResponse.data}).then(() => {removeMarkers();});
	</script>
</body>
</html>